<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Cards - Cards 2</title>
    <link rel="stylesheet" href="cards2.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-item" onclick="window.location.href='dashboard.html'">Cards 1</div>
            
            <div class="sidebar-item active">Cards 2</div>
            <div class="sidebar-item" onclick="window.location.href='charts.html'">Charts</div>
            <div class="sidebar-item" onclick="window.location.href='table.html'">Table 1</div>
            <div class="sidebar-item" onclick="window.location.href='table2.html'">Table 2</div>
        </div>
        
        <div class="main-content">
            <!-- Loading State -->
            <div id="loading-state" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading products, please wait.</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="error-container" style="display: none;">
                <div class="error-icon">⚠️</div>
                <h3 class="error-title">Oops, something went wrong.</h3>
                <p class="error-message">Please try again.</p>
                <button class="retry-button" onclick="loadProducts()">Retry</button>
            </div>

            <!-- Product Grid -->
            <div id="product-grid" class="product-grid" style="display: none;">
                <!-- Products will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Function to show loading state
        function showLoading() {
            document.getElementById('loading-state').style.display = 'flex';
            document.getElementById('error-state').style.display = 'none';
            document.getElementById('product-grid').style.display = 'none';
        }

        // Function to show error state
        function showError() {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('error-state').style.display = 'flex';
            document.getElementById('product-grid').style.display = 'none';
        }

        // Function to show products
        function showProducts() {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('error-state').style.display = 'none';
            document.getElementById('product-grid').style.display = 'grid';
        }

        // Function to parse CSV products data
        function parseCSVProducts(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const products = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Handle CSV with quotes and commas inside fields
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim()); // Add the last value
                
                if (values.length >= headers.length) {
                    const product = {};
                    headers.forEach((header, index) => {
                        let value = values[index] || '';
                        // Remove quotes if present
                        if (value.startsWith('"') && value.endsWith('"')) {
                            value = value.slice(1, -1);
                        }
                        product[header] = value;
                    });
                    products.push(product);
                }
            }
            
            return products;
        }

        // Function to create product card HTML
        function createProductCard(product) {
            const topBadge = (() => {
                if (product && typeof product.status === 'string' && product.status.trim().toLowerCase() === 'out of stock') {
                    return { text: 'Out of Stock', cls: 'out-of-stock' };
                }
                const isNew = String(product.isNew || '').toLowerCase() === 'true';
                if (isNew) {
                    return { text: 'New', cls: 'new' };
                }
                return null;
            })();

            const statusLabel = topBadge ? `<div class="status-label ${topBadge.cls}">${topBadge.text}</div>` : '';
            const statusClass = product.status ? product.status.toLowerCase().replace(/\s+/g, '-') : 'in-stock';
            
            return `
                <div class="product-card">
                    <div class="product-image-container">
                        <div class="product-image">
                            <img src="${product.imageUrl}" alt="${product.name}" onerror="this.src='images/placeholder.png'">
                        </div>
                        ${statusLabel}
                    </div>
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-description">${product.description || 'Product description not available.'}</p>
                    <div class="product-info">
                        <div class="stock-info">
                            <span class="info-icon"><img src="images/in-stock.svg" alt="stock"></span>
                            <span class="stock-status ${statusClass}">${product.status || 'In Stock'}</span>
                        </div>
                        <div class="sold-info">
                            <span class="info-icon"><img src="images/sold.svg" alt="sold"></span>
                            <span>${product.unitsSold || '0'} sold</span>
                        </div>
                    </div>
                    <div class="product-price">₹${product.price || '0'}</div>
                </div>
            `;
        }

        // Function to load products from API
        async function loadProducts() {
            showLoading();
            
            try {
                const response = await fetch('http://interview.surya-digital.in/get-products');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const products = parseCSVProducts(csvText);
                
                if (products && products.length > 0) {
                    const productGrid = document.getElementById('product-grid');
                    productGrid.innerHTML = products.map(product => createProductCard(product)).join('');
                    showProducts();
                } else {
                    throw new Error('No products found');
                }
                
            } catch (error) {
                console.error('Error loading products:', error);
                showError();
            }
        }

        // Load products when page loads
        window.onload = function() {
            loadProducts();
        };
    </script>
</body>
</html>
